import { useQuery } from '@tanstack/react-query'
import { KnowledgeBaseCard } from './-KnowledgeBaseCard'
import type { KnowledgeBaseSummary } from '@/lib/api'

function PublicKnowledgeBasesList() {
  const { data, isLoading } = useQuery({
    queryKey: ['my-knowledge-bases'],
    queryFn: async () => {
      const res = await fetch('/api/v1/ai/knowledge-bases')
      if (!res.ok) throw new Error('Failed to fetch')
      return res.json()
    },
  })

  if (isLoading) return <div className="text-center py-8">Loading...</div>

  const publicKBs = data?.knowledge_bases?.filter((kb: KnowledgeBaseSummary) => kb.visibility === 'public') || []

  return (
    <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
      {publicKBs.map((kb: KnowledgeBaseSummary) => (
        <KnowledgeBaseCard key={kb.id} kb={kb} isOwner={false} />
      ))}
      {publicKBs.length === 0 && (
        <div className="col-span-full text-center py-12 text-muted-foreground">
          No public knowledge bases available.
        </div>
      )}
    </div>
  )
}

export { PublicKnowledgeBasesList }

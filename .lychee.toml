# Lychee link checker configuration
# https://lychee.cli.rs/configuration/

# Root directory for resolving root-relative links in local files
# Note: In CI, this is overridden with an absolute path via --root-dir
# For local use, run from the repo root: lychee --root-dir $(pwd)/docs/dist docs/dist
root_dir = "docs/dist"

# Exclude these URL patterns from checking
exclude = [
  # Localhost and example URLs used in documentation
  "^https?://localhost",
  "^https?://127\\.0\\.0\\.1",
  "^https?://0\\.0\\.0\\.0",
  "^https?://example\\.com",
  "^https?://your-domain\\.com",
  "^https?://your-server\\.com",
  "^https?://your-fluxbase\\.com",
  "^https?://api\\.your",
  "^https?://your-org",

  # Email addresses
  "^mailto:",

  # Placeholder URLs
  "^https?://\\{",
  "^https?://\\$",
  "<your-",

  # GitHub edit links (auto-generated by Starlight, often rate-limited)
  "github\\.com/.*/edit/",

  # Fluxbase docs domain (may not be live yet)
  "^https?://docs\\.fluxbase\\.io",

  # Cloudflare dashboard (requires auth)
  "dash\\.cloudflare\\.com",

  # External sites with flaky availability or changed URLs
  "jumpcloud\\.com/support",
  "postgresql\\.org/docs/current/security",
]

# Accept these status codes as valid
accept = [
  200,
  204,
  301,
  302,
  307,
  308,
  429,  # Too Many Requests (GitHub rate limiting)
]

# Timeout for each request in seconds
timeout = 30

# Maximum number of concurrent requests (lower to avoid rate limits)
max_concurrency = 8

# Don't check fragments/anchors (can be flaky for external sites)
include_fragments = false

# User agent to use for requests
user_agent = "Mozilla/5.0 (compatible; lychee-link-checker)"

# Exclude files matching these patterns
exclude_path = [
  # Exclude auto-generated TypeDoc API docs (many internal links)
  "dist/api/sdk/",
  "dist/api/sdk-react/",
]

# Cache results to speed up subsequent runs
cache = true

# Maximum cache age (1 day)
max_cache_age = "1d"
